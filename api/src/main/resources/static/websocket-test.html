<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>WebSocket STOMP ì‹¤ì‹œê°„ ì§ˆë¬¸ í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
<h2>ğŸ“ WebSocket STOMP - ì‹¤ì‹œê°„ ì§ˆë¬¸ í…ŒìŠ¤íŠ¸</h2>

<button onclick="connect()">1. ì—°ê²°í•˜ê¸°</button>
<button onclick="sendQuestion()">2. ì§ˆë¬¸ ì „ì†¡</button>

<pre id="log"></pre>

<script>
    let stompClient;
    const userId = 1;
    const lectureId = 1;

    function log(message) {
      document.getElementById("log").innerText += message + "\n";
    }

    function connect() {
      const socket = new SockJS("http://localhost:8080/ws");
      stompClient = Stomp.over(socket);
      stompClient.connect({ "userId": userId }, function () {
        log("âœ… ì—°ê²°ë¨");

        stompClient.subscribe(`/topic/api/lectures/${lectureId}/live`, function (message) {
          const body = JSON.parse(message.body);

          // ë©”ì‹œì§€ì— ì €ì¥ëœ ì§ˆë¬¸ ì •ë³´ ë³´ê¸°
          log("ğŸ“© ìˆ˜ì‹  ë©”ì‹œì§€:");
          log(JSON.stringify(body, null, 2)); // ë“¤ì—¬ì“°ê¸° í•´ì„œ ë³´ê¸° ì¢‹ê²Œ
        });
      });
    }

    function sendQuestion() {
      const payload = {
        type: "question",
        request: {
          lectureId: lectureId,
          content: "ğŸ’¬ í…ŒìŠ¤íŠ¸ ì§ˆë¬¸ì…ë‹ˆë‹¤!"
        }
      };

      stompClient.send(`/app/api/lectures/${lectureId}/live`, {}, JSON.stringify(payload));
      log("ğŸ“¤ ì§ˆë¬¸ ì „ì†¡: " + JSON.stringify(payload));
    }
</script>
</body>
</html>

